<!DOCTYPE html>
<html>

<head>
  <title>Login Test</title>
</head>

<body>
  <h1>Login Test</h1>
  <form id="testForm">
    <input type="email" id="email" placeholder="Email" value="admin@test.com">
    <input type="password" id="password" placeholder="Password" value="admin123">
    <button type="submit">Test Login</button>
  </form>
  <div id="result"></div>

  <script>
    // Simple API request function for testing
    async function testApiRequest(url, options = {}) {
      const defaultOptions = {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
        },
      };

      const finalOptions = { ...defaultOptions, ...options };

      if (options.headers) {
        finalOptions.headers = { ...defaultOptions.headers, ...options.headers };
      }

      try {
        const response = await fetch(url, finalOptions);
        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.message || `HTTP error! status: ${response.status}`);
        }

        return { success: true, data };
      } catch (error) {
        console.error('API Request failed:', error);
        throw error;
      }
    }

    document.getElementById('testForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const resultDiv = document.getElementById('result');

      try {
        console.log('Testing login with:', { email, password });

        const response = await testApiRequest('/api/auth/login', {
          method: 'POST',
          body: JSON.stringify({ email, password })
        });

        console.log('Response:', response);
        resultDiv.innerHTML = `
                    <h3>Success!</h3>
                    <p>Token: ${response.data.data.token}</p>
                    <p>User: ${response.data.data.user.name}</p>
                `;

        // Test cookie setting
        document.cookie = `token=${response.data.data.token}; path=/; max-age=3600`;
        console.log('Cookie set, redirecting...');

        setTimeout(() => {
          window.location.href = '/dashboard';
        }, 2000);

      } catch (error) {
        console.error('Login error:', error);
        resultDiv.innerHTML = `<h3>Error:</h3><p>${error.message}</p>`;
      }
    });
  </script>
</body>

</html>